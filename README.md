### Запуск
Для корректной работы приложения достаточно установить `docker` и `docker-compose`.

```bash
$ cd docker/
$ docker-compose up -d 
```
Приложение - http://localhost:8081/

При первом входе в приложение пользователя встречает страница установщика, выполняющего нужные настройки для корректной работы приложения. Установка проходит в три этапа: подключение к базе данных, создание базы данных, добавление пользователя с должностью «Главный администратор».

### Остановить
```bash
$ cd docker/
$ docker-compose down 
```

### Цель Работы
Целью выпускной квалификационной работы является разработка приложения для ресторанного бизнеса.  Приложение решает проблему предпринимателей в администрировании собственных ресторанных бизнесов. В частности, дает возможность автоматизировать работу ресторанов и управление сотрудниками с использованием готовых решений, а также расширять функционал за счет подключения модулей.

Приложение включает в себя две части: панель администратора и панель сотрудника. Пользователями приложения являются сотрудники ресторанов. В зависимости от прав авторизованного пользователя ему видны только те функции, которые соответствуют определенному уровню прав.

Панель администратора доступна только для сотрудников с должностью администратора. В функционал панели входит управление ресторанами, в частности, создание ресторана, добавление и создание модуля, добавление сотрудника с указанием должности.

Панель сотрудника доступна всем пользователям. В панели отображается информация о сотруднике. Функционал панели может отличаться в зависимости от должности и добавленных модулей.
### Структура базы данных

- `Host`: mysql
- `User`: root
- `Password`: 123

Используй PhpMyAdmin - http://localhost:8080/

Или
```bash
$ cd docker/
$ docker-compose exec mysql bash
$ mysql -u root -p
```

Приложение работает с сотрудниками ресторанов и модулями. Реализованы таблицы `users` и `accounts` для взаимодействия пользователей с приложением и разделения доступа к частям приложения в зависимости от должности сотрудника. Также в приложении доступна возможность управления несколькими ресторанами, для этого реализована таблица `restaurants`. Приложение можно расширять за счет подключения модулей, для этого реализована таблица `modules`. База данных состоит из одиннадцати таблиц.

Таблица `users` содержит информацию о пользователях, такую как: фамилия, имя, отчество, дата рождения, дата добавление пользователя. Каждый пользователь является сотрудником одного из ресторанов.

Таблица `accounts` содержит аккаунты пользователей для входа в панели управления приложением. В таблице указан `token`, который служит для авторизации. У каждого аккаунта может быть только один `token`, чтобы у пользователя был только один сеанс для безопасности.

Таблица `position` содержит список должностей сотрудников. У каждого сотрудника могут быть несколько должностей в нескольких ресторанах. Также должность может быть добавлена с помощью модуля. В таблице содержится поле `is_admin`, которое указывает должности администратора.

Таблицы `menu_admin` и `menu_employee` содержат списки пунктов меню для панелей управлений. Эти пункты добавляются с помощью модулей.

![ERDDiagram1](https://github.com/MOCTNK/docker-nginx-php/assets/71684726/cb7c1f4e-e7b0-42a5-9050-22baf74f3386)

Таблица `users` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id пользователя;
- `name` – тип CHAR(100) – имя пользователя;
- `surname` – тип CHAR(100) – фамилия пользователя;
- `patronymic` – тип CHAR(100) – отчество пользователя;
- `date` – тип DATETIME – дата создания записи;
- `date_of_birth` – тип DATE – дата рождения пользователя;
- `avatar` – тип CHAR(50) – путь до изображения пользователя.

Таблица `accounts` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id аккаунта;
- `id_user` – тип INT, FOREIGN KEY – id пользователя;
- `login` – тип CHAR(50) – логин аккаунта;
- `password` – тип CHAR(50) – пароль аккаунта;
- `token` – тип CHAR(50) – токен авторизации;
- `date` – тип DATETIME – дата создания записи.

Таблица `positions` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id должности;
- `name` – тип CHAR(100) – название должности;
- `code_name` – тип CHAR(50) – кодовое название должности;
- `is_admin` – тип BOOL – указывает вид должности, административная или нет.

Таблица modules содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id модуля;
- `name`–тип CHAR(50) – название модуля.

Таблица `restaurans` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id ресторана;
- `name` – тип CHAR(100) – название ресторана;
- `address` – типCHAR(255) – адрес модуля;
- `about` – тип CHAR(255)  – описание ресторана;
- `logo` – типCHAR(50) – путь до изображения ресторана;
- `date` – тип DATETIME – дата создания записи.

Таблица `user_position` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id должностей пользователей;
- `id_user` – тип INT, FOREIGN KEY – id пользователя;
- `id_position` – тип INT, FOREIGN KEY – id должности.

Таблица `module_position` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id должностей пользователей;
- `id_user` – тип INT, FOREIGN KEY – id пользователя;
- `id_position` – тип INT, FOREIGN KEY – id должности.

Таблица `restaurant_employes` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id сотрудников ресторанов;
- `id_restaurant` – тип INT, FOREIGN KEY – id ресторана;
- `id_user_position` – тип INT, FOREIGN KEY – id должностей пользователей;
- `date` – тип DATETIME – дата создания записи.

Таблица `menu_admin` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id меню панели администратора;
- `name` – тип CHAR(100) – название пункта меню;
- `code_name` – тип CHAR(50) – кодовое название пункта меню;
- `id_module` – тип INT, FOREIGN KEY – id модуля.

Таблица `menu_employee` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id меню панели сотрудника;
- `name` – тип CHAR(100) – название пункта меню;
- `code_name` – тип CHAR(50) – кодовое название пункта меню
- `id_module` – тип INT, FOREIGN KEY – id модуля.

Таблица `module_table` содержит следующие поля:
- `id` – тип INT, PRIMARY KEY, AUTO_INCREMENT – id меню панели сотрудника;
- `id_module` – тип INT, FOREIGN KEY – id модуля;
- `name` – типCHAR(50) – название таблицы.
### Реализация модулей

В приложении реализован класс `Module`, от которого наследуются все модули. Имя класса модуля должно соответствовать имени корневой папки модуля. Все модули хранятся в `/application/modules`. Модуль представляет папку со структурой. В папке resources находятся ресурсные файлы, например изображения, шрифты, видеозаписи, аудиозаписи и т.д. В папке scripts находятся JS-файлы, которые подключаются в представление страницы модуля. В папке style находятся CSS-файлы, которые подключаются в представление страницы модуля. В папке view находятся HTML-файлы представления страницы модуля.

Модуль дает возможность расширить функционал приложения. Есть возможность работать с базой данных, добавить пункты меню панели сотрудника и панели управления ресторана, создать новые таблицы, работать со встроенными таблицами приложения. Модуль можно легко добавить и легко удалить без ошибок работы приложения.

В конструкторе класса указывается информация о модуле, такая как название, описание, версия, имя автора и описание пунктов меню панели сотрудника. В описании пунктов меню панели сотрудника указывается название пункта и должность сотрудника, которому разрешен доступ.

```php
public function __construct() {
    parent::__construct();
    $this->name = 'administrator';
    $this->about = 'Добавляет функционал для администратора.';
    $this->version = '0.1';
    $this->author = 'Мостовой Даниил';
    $this->descriptionMenuItemEmployee = [
        'manager_users' => [
            'is_admin' => true
        ]
    ];
}
```

#### Методы класса Module

- `init()` - метод выполняется при подключении модуля;
- `disable()` - метод выполняется при отключении модуля;
- `action($post, $accountData, $restaurantData = [])` - метод выполняет запрос клиента. В метод передается название действия и данные авторизированного аккаунта и ресторана. В зависимости от переданного названия выполняется определенный код;
- `getDescriptionMenuItemEmployee($item)` - метод возвращает описание пункта меню панели сотрудника;
- `getIdModule($name)` - метод возвращает `id` модуля из таблицы `modules`;
- `addMenuItemAdmin($name, $action)` - метод добавляет пункт меню панели администратора;
- `addMenuItemEmployee($name, $action)` - метод добавляет пункт меню панели сотрудника;
- `addPosition($name, $codeName)` - метод добавляет должность сотрудника;
- `select($dbName, $columns = [], $params = [], $equality = true, $isOR = true)` - метод выполняет подготовленный SQL-запрос для получения записей таблицы. В метод передается название таблицы и массив подготовленных параметров. Название таблицы сверяется, чтобы избежать SQL-инъекции. В результате выполнения возвращается ассоциативный массив записей таблицы;
- `insert($dbName, $columns, $params)` - метод выполняет подготовленный SQL-запрос для вставки новой записи в таблицу. В метод передается название таблицы, массив названий атрибутов и массив подготовленных параметров. Название таблицы и атрибутов сверяется, чтобы избежать SQL-инъекции. В результате выполнения в указанную таблицу вставляется запись;
- `update($dbName, $id, $columns, $params)` - метод выполняет подготовленный SQL-запрос для обновления записи в таблице. В метод передается название таблицы, `id` записи, массив названий атрибутов и массив подготовленных параметров. Название таблицы и атрибутов сверяется, чтобы избежать SQL-инъекции. В результате выполнения в указанную таблицу вставляется запись;
- `delete($dbName, $columns, $params, $equality = true, $isOR = true)` - метод выполняет подготовленный SQL-запрос для удаления записи из таблицы. В метод передается название таблицы, массив названий атрибутов и массив подготовленных параметров. Название таблицы и атрибутов сверяется, чтобы избежать SQL-инъекции. В результате выполнения указанные записи удаляются;
- `showTables()` - метод возвращяет массив имен таблиц из базы данных;
- `showColumns($dbName)` - метод возвращяет массив имен столбцов указанной таблицы;
- `checkColumns($dbName, $name)` - метод проверяет существования столбца в таблице;
- `getView($path, $vars = [])` - метод возвращает представление модуля.